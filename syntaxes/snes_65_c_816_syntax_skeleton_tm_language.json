{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "SNES 65C816 Assembly",
  "patterns": [
    { "include": "#comments" },
    { "include": "#punctuation" },
    { "include": "#literals" },
    { "include": "#strings" },
    { "include": "#chars" },
    { "include": "#operators" },
    { "include": "#opcodes_arithmetic" },
    { "include": "#opcodes_logic" },
    { "include": "#opcodes_memory" },
    { "include": "#opcodes_branch" },
    { "include": "#opcodes_flow" },
    { "include": "#opcodes_stack" },
    { "include": "#opcodes_status" },
    { "include": "#opcodes_bit" },
    { "include": "#opcodes_system" },
    { "include": "#macros" },
    { "include": "#labels" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        { "name": "comment.line.snes65c816", "match": ";.*$" },
        { "name": "comment.block.snes65c816", "begin": "/\\*", "end": "\\*/" }
      ]
    },
    "punctuation": {
      "patterns": [
        { "name": "punctuation.parenthesis.snes65c816", "match": "\\(|\\)" },
        { "name": "punctuation.separator.snes65c816", "match": "," }
      ]
    },
    "literals": {
      "patterns": [
        { "name": "constant.numeric.binary.snes65c816", "match": "%[01]+\\b" },
        { "name": "constant.numeric.hex.snes65c816", "match": "(\\$[0-9A-Fa-f]+\\b)|\\b([0-9A-Fa-f]+h\\b)" },
        { "name": "constant.numeric.decimal.snes65c816", "match": "\\b[0-9]+\\b" }
      ]
    },
    "strings": {
      "name": "string.quoted.double.snes65c816", "begin": "\"", "end": "\"" },
    "chars": {
      "patterns": [
        { "name": "string.quoted.single.snes65c816", "match": ".'" }
      ]
    },
    "operators": {
      "patterns": [
        { "name": "keyword.operator.immediate.snes65c816", "match": "#" },
        { "name": "keyword.operator.misc.snes65c816", "match": "=|<>|:=|\\+|-|\\*|/|&|~|\\||<<|>>|&&|\\|\\||!|<|>|<=|>=" }
      ]
    },
    "labels": {
      "patterns": [
        {
          "comment": "Global Label Definitions with Double Colon",
          "name": "entity.name.label.global.doublecolon.definition.snes65c816",
          "match": "^[ \\t]*([a-zA-Z_][\\w#@]*)(?=::)",
          "captures": {
            "1": { "name": "entity.name.label.global.doublecolon.definition.snes65c816" }
            }
          },
        {
          "comment": "Local Label Definitions (dot-prefixed, colon optional)",
          "name": "entity.name.label.local.definition.snes65c816",
          "match": "^[ \\t]*\\.[a-zA-Z_][\\w#@]*[:]?\\b"
        },
        {
          "comment": "Global Label Definitions (non-dot-prefixed, ending with single colon)",
          "name": "entity.name.label.global.definition.snes65c816",
          "match": "^[ \\t]*[a-zA-Z_][\\w#@]*:(?=\\s|$)"
        },
        {
          "name": "variable.other.label.reference.snes65c816",
          "match": "(?<!:)\\b([a-zA-Z_][a-zA-Z0-9_]*)\\b"
        }
      ]
    },
    "opcodes_load": {
      "patterns": [
        {
          "comment": "Data Load Instructions",
          "name": "keyword.mnemonic.load.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:lda|ldx|ldy|sta|stx|sty|stz|mvn|mvp|pea|pei|per)\\b"
        }
      ]
    },
    "opcodes_transfer_reg": {
      "patterns": [
        {
          "comment": "Transfer Between Registers Instructions",
          "name": "keyword.mnemonic.transferreg.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:txa|tax|tya|tay|tsx|txs|txy|tyx|tcd|tdc|tsc|tcs)\\b"
        }
      ]
    },
    "opcodes_arithmetic": {
      "patterns": [
        {
          "comment": "Arithmetic Instructions",
          "name": "keyword.mnemonic.math.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:adc|sbc|inc|dec)\\b"
        }
      ]
    },
    "opcodes_bitwise": {
      "patterns": [
        {
          "comment": "Bitwise Instructions",
          "name": "keyword.mnemonic.bitwise.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:and|ora|eor|bit|trb|tsb)\\b"
        }
      ]
    },
    "opcodes_rotate": {
      "patterns": [
        {
          "comment": "Rotate Instructions",
          "name": "keyword.mnemonic.rotate.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:asl|lsr|rol|ror)\\b"
        }
      ]
    },
    "opcodes_compare": {
      "patterns": [
        {
          "comment": "Compare Instructions",
          "name": "keyword.mnemonic.compare.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:cmp|cpy|cpx)\\b"
        }
      ]
    },
    "opcodes_branch": {
      "patterns": [
        {
          "comment": "Branch Instructions",
          "name": "keyword.mnemonic.branch.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:bcc|bcs|beq|bmi|bne|bpl|bra|brl|bvc|bvs)\\b"
        }
      ]
    },
    "opcodes_flow": {
      "patterns": [
        {
          "comment": "Program Flow Instructions",
          "name": "keyword.mnemonic.flow.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:jmp|jml|jsr|jsl|rts|rtl|rti)\\b"
        }
      ]
    },
    "opcodes_stack": {
      "patterns": [
        {
          "comment": "Stack Instructions",
          "name": "keyword.mnemonic.stack.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:pha|pla|php|plp|phb|plb|phd|pld|phk|phx|phy|plx|ply)\\b"
        }
      ]
    },
    "opcodes_flags": {
      "patterns": [
        {
          "comment": "Processor Flag Instructions",
          "name": "keyword.mnemonic.flags.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:clc|sec|cli|sei|cld|sed|clv|rep|sep|xce)\\b"
        }
      ]
    },
    "opcodes_misc": {
      "patterns": [
        {
          "comment": "Miscellaneous Instructions",
          "name": "keyword.mnemonic.misc.snes65c816",
          "match": "^[ \\t]*:?[ \\t]*\\b(?i:cop|brk|stp|wai|wdm|nop|xba|cmp|cpy|cpx)\\b"
        }
      ]
    },
    "macros": {
      "patterns": [
        
        {
          "name": "meta.preprocessor.macro.snes65c816",
          "match": "^\\s*\\.(macro|endmacro)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\b",
          "captures": {
            "1": { "name": "keyword.control.macro.snes65c816" },
            "2": { "name": "entity.name.function.macro.snes65c816" }
          }
        },
        
        {
          "name": "entity.name.function.macro.use.snes65c816",
          "match": "^\\s*([a-zA-Z_][a-zA-Z0-9_]*)\\s*(?=\\()",
          "captures": {
            "1": { "name": "entity.name.function.macro.snes65c816" }
          }
        }
      ]
    }
  },
  "scopeName": "source.65c816"
}
